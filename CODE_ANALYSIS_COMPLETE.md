# ĞŸĞĞ›ĞĞ«Ğ™ ĞĞĞĞ›Ğ˜Ğ— ĞŸĞ ĞĞ•ĞšĞ¢Ğ: BEER ABC ANALYSIS

**Ğ”Ğ°Ñ‚Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:** 2025-11-16
**ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€:** Claude Sonnet 4.5
**Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:** de0b09f (ADD: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²)

---

## Ğ¡ĞĞ”Ğ•Ğ Ğ–ĞĞĞ˜Ğ•

1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#1-Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
2. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#2-ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
3. [ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸](#3-Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ-Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸)
4. [Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹](#4-ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ-Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹)
5. [Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸](#5-Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸)
6. [API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ](#6-api-Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ)
7. [Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#7-ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)

---

## 1. ĞĞ‘Ğ—ĞĞ  ĞŸĞ ĞĞ•ĞšĞ¢Ğ

### 1.1. ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

Flask Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ¿Ğ¸Ğ²Ğ° Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ iiko API.

**Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº:**
- **Backend:** Python 3.x, Flask
- **Data Processing:** pandas, numpy
- **External API:** iiko REST API (XML responses)
- **Frontend:** Vanilla JavaScript, HTML5, CSS3
- **Deployment:** Render (PaaS) Ñ persist disk
- **Storage:** JSON files (taps_data.json), iiko API

### 1.2. Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

| Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° | URL | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|----------|
| **ABC/XYZ Ğ¤Ğ°ÑĞ¾Ğ²ĞºĞ°** | `/` (index.html) | ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ° Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ°Ğ¼ |
| **Ğ Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ°Ğ¼** | `/draft` | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ° (Ğ¾Ğ±ÑŠĞµĞ¼Ñ‹ Ğ² Ğ»Ğ¸Ñ‚Ñ€Ğ°Ñ…, ĞºĞµĞ³Ğ¸, ABC/XYZ) |
| **Ğ Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ¼ĞµĞ½Ğ°Ğ¼** | `/waiters` | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² (Ğ»Ğ¸Ñ‚Ñ€Ñ‹, Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºĞ°, Ñ‚Ğ¾Ğ¿-10 ÑĞ¾Ñ€Ñ‚Ğ¾Ğ²) |
| **ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ ĞºÑ€Ğ°Ğ½Ğ¾Ğ²** | `/taps` | ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºÑ€Ğ°Ğ½Ğ¾Ğ² (ÑÑ‚Ğ°Ñ‚ÑƒÑ, Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚) |
| **Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸** | `/taps/<bar_id>` | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸ Ğ±Ğ°Ñ€Ğ° (START/STOP/REPLACE) |
| **ĞÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹** | `/stocks` | ĞÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ğ°Ñ… (Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ, Ñ„Ğ°ÑĞ¾Ğ²ĞºĞ°, ĞºÑƒÑ…Ğ½Ñ) |

### 1.3. ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

#### ABC ĞĞ½Ğ°Ğ»Ğ¸Ğ· (3 Ğ±ÑƒĞºĞ²Ñ‹)
- **1-Ñ Ğ±ÑƒĞºĞ²Ğ°:** ABC Ğ¿Ğ¾ Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºĞµ (A = Ñ‚Ğ¾Ğ¿ 80%, B = 80-95%, C = 95-100%)
- **2-Ñ Ğ±ÑƒĞºĞ²Ğ°:** ABC Ğ¿Ğ¾ % Ğ½Ğ°Ñ†ĞµĞ½ĞºĞ¸
- **3-Ñ Ğ±ÑƒĞºĞ²Ğ°:** ABC Ğ¿Ğ¾ Ğ¼Ğ°Ñ€Ğ¶Ğµ Ğ² Ñ€ÑƒĞ±Ğ»ÑÑ…
- **ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ:** Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ "AAA" (Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ), "CCC" (Ñ…ÑƒĞ´ÑˆĞ¸Ğµ)

#### XYZ ĞĞ½Ğ°Ğ»Ğ¸Ğ·
- **X:** Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ñ€Ğ¾Ñ (CV < 10%)
- **Y:** Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ²Ğ°Ñ€Ğ¸Ğ°Ñ†Ğ¸Ñ (CV 10-25%)
- **Z:** ĞĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ñ€Ğ¾Ñ (CV > 25%)
- **ĞœĞµÑ‚Ğ¾Ğ´:** ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ²Ğ°Ñ€Ğ¸Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ°Ğ¼

#### Ğ Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¸Ğ²Ğ¾
- ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¾Ğ±ÑŠĞµĞ¼Ğ¾Ğ² Ğ¸Ğ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹: "Ğ¤ĞµÑÑ‚Ğ¥Ğ°ÑƒÑ Ğ¥ĞµĞ»Ğ»ĞµÑ (0,5)" â†’ 0.5L
- ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ² Ğ»Ğ¸Ñ‚Ñ€Ñ‹ Ğ¸ ĞºĞµĞ³Ğ¸ (30L, 50L)
- Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ñƒ (TotalLiters)

---

## 2. Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞŸĞ ĞĞ•ĞšĞ¢Ğ

### 2.1. Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ

```
beer-abc-analysis/
â”œâ”€â”€ app.py (1720 ÑÑ‚Ñ€Ğ¾Ğº) â­ Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ¤ĞĞ™Ğ›
â”‚   â””â”€â”€ 24 API endpoints
â”‚
â”œâ”€â”€ config.py (10 ÑÑ‚Ñ€Ğ¾Ğº) âš ï¸ CREDENTIALS Ğ’ ĞĞ¢ĞšĞ Ğ«Ğ¢ĞĞœ Ğ’Ğ˜Ğ”Ğ•
â”‚   â””â”€â”€ iiko API credentials
â”‚
â”œâ”€â”€ core/ (Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)
â”‚   â”œâ”€â”€ iiko_api.py (71 ÑÑ‚Ñ€Ğ¾ĞºĞ°)
â”‚   â”‚   â””â”€â”€ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² iiko API
â”‚   â”‚
â”‚   â”œâ”€â”€ olap_reports.py (551 ÑÑ‚Ñ€Ğ¾ĞºĞ°)
â”‚   â”‚   â”œâ”€â”€ get_store_balances() - Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ğ°Ñ…
â”‚   â”‚   â”œâ”€â”€ get_nomenclature() - XML Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
â”‚   â”‚   â”œâ”€â”€ get_beer_sales_report() - Ñ„Ğ°ÑĞ¾Ğ²ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ get_draft_sales_report() - Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ
â”‚   â”‚   â””â”€â”€ get_draft_sales_by_waiter_report() - Ñ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ½Ñ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ data_processor.py (168 ÑÑ‚Ñ€Ğ¾Ğº)
â”‚   â”‚   â”œâ”€â”€ prepare_dataframe() - Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ OLAP Ğ² pandas
â”‚   â”‚   â”œâ”€â”€ aggregate_by_beer_and_bar() - Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â””â”€â”€ get_weekly_sales() - Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¿Ğ¾ Ğ½ĞµĞ´ĞµĞ»ÑĞ¼
â”‚   â”‚
â”‚   â”œâ”€â”€ abc_analysis.py (168 ÑÑ‚Ñ€Ğ¾Ğº)
â”‚   â”‚   â”œâ”€â”€ calculate_abc_category() - Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ ĞŸĞ°Ñ€ĞµÑ‚Ğ¾
â”‚   â”‚   â””â”€â”€ perform_abc_analysis_by_bar() - Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ñƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ xyz_analysis.py (173 ÑÑ‚Ñ€Ğ¾ĞºĞ¸)
â”‚   â”‚   â”œâ”€â”€ calculate_coefficient_of_variation() - Ñ€Ğ°ÑÑ‡ĞµÑ‚ CV
â”‚   â”‚   â””â”€â”€ categorize_xyz() - ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ X/Y/Z
â”‚   â”‚
â”‚   â”œâ”€â”€ draft_analysis.py (423 ÑÑ‚Ñ€Ğ¾ĞºĞ¸)
â”‚   â”‚   â”œâ”€â”€ extract_beer_info() - Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ "(0,5)"
â”‚   â”‚   â”œâ”€â”€ get_beer_summary() - ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ¼Ñƒ
â”‚   â”‚   â””â”€â”€ calculate_xyz_for_summary() - XYZ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾
â”‚   â”‚
â”‚   â”œâ”€â”€ category_analysis.py (324 ÑÑ‚Ñ€Ğ¾ĞºĞ¸)
â”‚   â”‚   â”œâ”€â”€ analyze_category() - Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ ÑÑ‚Ğ¸Ğ»Ñ Ğ¿Ğ¸Ğ²Ğ°
â”‚   â”‚   â””â”€â”€ get_category_summary() - ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
â”‚   â”‚
â”‚   â”œâ”€â”€ waiter_analysis.py (427 ÑÑ‚Ñ€Ğ¾Ğº) âš ï¸ Ğ”Ğ£Ğ‘Ğ›Ğ˜Ğ Ğ£Ğ•Ğ¢ extract_beer_info()
â”‚   â”‚   â”œâ”€â”€ get_waiter_summary() - ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ¼ĞµĞ½Ğ°Ğ¼
â”‚   â”‚   â””â”€â”€ get_waiter_beer_details() - Ñ‚Ğ¾Ğ¿-10 ÑĞ¾Ñ€Ñ‚Ğ¾Ğ² Ğ±Ğ°Ñ€Ğ¼ĞµĞ½Ğ°
â”‚   â”‚
â”‚   â””â”€â”€ taps_manager.py (421 ÑÑ‚Ñ€Ğ¾ĞºĞ°) âš ï¸ RACE CONDITIONS
â”‚       â”œâ”€â”€ start_tap() - Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ
â”‚       â”œâ”€â”€ stop_tap() - Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ
â”‚       â”œâ”€â”€ replace_tap() - ÑĞ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ñ€Ñ‚
â”‚       â””â”€â”€ _save_data() - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² JSON (Ğ‘Ğ•Ğ— Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞĞš!)
â”‚
â”œâ”€â”€ templates/ (HTML + Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ JS + CSS)
â”‚   â”œâ”€â”€ index.html (Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ABC/XYZ)
â”‚   â”œâ”€â”€ draft.html (1142 ÑÑ‚Ñ€Ğ¾ĞºĞ¸) - Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ°Ğ¼
â”‚   â”œâ”€â”€ waiters.html (1040 ÑÑ‚Ñ€Ğ¾Ğº) - Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ¼ĞµĞ½Ğ°Ğ¼
â”‚   â”œâ”€â”€ taps.html (1034 ÑÑ‚Ñ€Ğ¾ĞºĞ¸) - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ ĞºÑ€Ğ°Ğ½Ğ¾Ğ²
â”‚   â”œâ”€â”€ taps_main.html (387 ÑÑ‚Ñ€Ğ¾Ğº) - Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ±Ğ°Ñ€Ğ°
â”‚   â”œâ”€â”€ taps_bar.html (1355 ÑÑ‚Ñ€Ğ¾Ğº) - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸
â”‚   â””â”€â”€ stocks.html (1348 ÑÑ‚Ñ€Ğ¾Ğº) - Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹
â”‚
â”œâ”€â”€ data/ âš ï¸ HARDCODED PATHS
â”‚   â”œâ”€â”€ taps_data.json - ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ğ½Ğ¾Ğ²
â”‚   â””â”€â”€ all_products.json - ĞºÑÑˆ Ğ½Ğ¾Ğ¼ĞµĞ½ĞºĞ»Ğ°Ñ‚ÑƒÑ€Ñ‹
â”‚
â””â”€â”€ /kultura/ (Render persist disk)
    â””â”€â”€ taps_data.json - production storage
```

### 2.2. Dependency Map & Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL: iiko API                     â”‚
â”‚  https://first-federation.iiko.it/resto/api                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP GET/POST (XML/JSON)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND: Flask app.py (24 endpoints)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ core/iiko_api.py                                     â”‚  â”‚
â”‚  â”‚  â€¢ authenticate() â†’ token                            â”‚  â”‚
â”‚  â”‚  â€¢ logout() â†’ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ñ‚ âš ï¸ ĞĞ• Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ğ’Ğ«Ğ—Ğ«Ğ’!   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                             â”‚
â”‚               â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ core/olap_reports.py                                 â”‚  â”‚
â”‚  â”‚  â€¢ get_nomenclature() âš ï¸ ĞĞ• ĞšĞ­Ğ¨Ğ˜Ğ Ğ£Ğ•Ğ¢Ğ¡Ğ¯!            â”‚  â”‚
â”‚  â”‚  â€¢ get_beer_sales_report("ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸ Ğ¤Ğ°ÑĞ¾Ğ²ĞºĞ°")         â”‚  â”‚
â”‚  â”‚  â€¢ get_draft_sales_report("ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸ Ğ Ğ¾Ğ·Ğ»Ğ¸Ğ²")         â”‚  â”‚
â”‚  â”‚  â€¢ get_store_balances() â†’ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ğ°Ñ…        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                             â”‚
â”‚               â–¼ OLAP JSON data                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ core/data_processor.py                               â”‚  â”‚
â”‚  â”‚  â€¢ DataFrame transformation (pandas)                 â”‚  â”‚
â”‚  â”‚  â€¢ aggregate_by_beer_and_bar()                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â”€â”€â–º core/abc_analysis.py                   â”‚
â”‚               â”‚      â€¢ Pareto 80/15/5                       â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â”€â”€â–º core/xyz_analysis.py                   â”‚
â”‚               â”‚      â€¢ Coefficient of Variation             â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â”€â”€â–º core/draft_analysis.py                 â”‚
â”‚               â”‚      â€¢ extract_beer_info("(0,5)")           â”‚
â”‚               â”‚      â€¢ Liters aggregation                   â”‚
â”‚               â”‚                                             â”‚
â”‚               â”œâ”€â”€â”€â”€â–º core/category_analysis.py              â”‚
â”‚               â”‚      â€¢ Group by Style                       â”‚
â”‚               â”‚                                             â”‚
â”‚               â””â”€â”€â”€â”€â–º core/waiter_analysis.py                â”‚
â”‚                      â€¢ Group by WaiterName                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ core/taps_manager.py                                 â”‚  â”‚
â”‚  â”‚  â€¢ CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸                           â”‚  â”‚
â”‚  â”‚  â€¢ JSON storage âš ï¸ NO LOCKS = RACE CONDITIONS!      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                             â”‚
â”‚               â–¼ JSON response                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼ HTTP JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FRONTEND: Vanilla JavaScript (in templates)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ fetch() API calls                                        â”‚
â”‚  â€¢ Dynamic HTML rendering (innerHTML âš ï¸ XSS RISK)          â”‚
â”‚  â€¢ Dark/Light theme (localStorage)                          â”‚
â”‚  â€¢ Responsive design (@media queries)                       â”‚
â”‚  â€¢ CSV export (UTF-8 BOM)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ĞĞĞ™Ğ”Ğ•ĞĞĞ«Ğ• ĞĞ¨Ğ˜Ğ‘ĞšĞ˜

### Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ° ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸:
- ğŸ”´ **ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ** - Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ½ĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
- ğŸŸ  **Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™** - ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°, Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ
- ğŸŸ¡ **Ğ¡Ğ Ğ•Ğ”ĞĞ˜Ğ™** - Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ
- ğŸŸ¢ **ĞĞ˜Ğ—ĞšĞ˜Ğ™** - ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ, Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ A: ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• ĞĞ¨Ğ˜Ğ‘ĞšĞ˜

#### ğŸ”´ **A1. ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ**

**Ğ¤Ğ°Ğ¹Ğ»:** `config.py:7`

**ĞšĞ¾Ğ´:**
```python
IIKO_PASSWORD = "ApiPass2024!"  # âš ï¸ Ğ¥Ğ ĞĞĞ˜Ğ¢Ğ¡Ğ¯ Ğ’ Ğ Ğ•ĞŸĞĞ—Ğ˜Ğ¢ĞĞ Ğ˜Ğ˜!
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ£Ñ‡ĞµÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ iiko API Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
# config.py
import os

IIKO_PASSWORD = os.environ.get('IIKO_PASSWORD')
if not IIKO_PASSWORD:
    raise ValueError("IIKO_PASSWORD environment variable not set!")
```

**Render deployment:**
```bash
# Ğ’ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… Render Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Environment Variable:
IIKO_PASSWORD = ApiPass2024!
```

---

#### ğŸŸ  **A2. Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸ Ğ±ĞµĞ· ÑƒÑ‡ĞµÑ‚Ğ° persist disk**

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:** `app.py:1078`, `app.py:1159`

**ĞšĞ¾Ğ´:**
```python
products_file = os.path.join('data', 'all_products.json')  # âš ï¸ ĞĞ• Ğ£Ğ§Ğ˜Ğ¢Ğ«Ğ’ĞĞ•Ğ¢ /kultura/
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸÑƒÑ‚ÑŒ `data/` Ğ½Ğµ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Render Ñ persist disk `/kultura/`.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
# Ğ’ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ app.py (ĞºĞ°Ğº Ğ´Ğ»Ñ TAPS_DATA_PATH)
PRODUCTS_DATA_PATH = os.environ.get('PRODUCTS_DATA_FILE', 'data/all_products.json')
if os.path.exists('/kultura'):
    PRODUCTS_DATA_PATH = '/kultura/all_products.json'

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
with open(PRODUCTS_DATA_PATH, 'r') as f:
    products = json.load(f)
```

---

#### ğŸŸ¡ **A3. Import Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**

**Ğ¤Ğ°Ğ¹Ğ»:** `app.py:1118-1120`

**ĞšĞ¾Ğ´:**
```python
@app.route('/api/update-nomenclature', methods=['POST'])
def update_nomenclature():
    try:
        import requests  # âš ï¸ Ğ˜ĞœĞŸĞĞ Ğ¢ Ğ’ĞĞ£Ğ¢Ğ Ğ˜ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
        import xml.etree.ElementTree as ET
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ»Ğ¾Ñ…Ğ°Ñ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°, requests ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² core Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ….

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°:
```python
# app.py (Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°)
import requests
import xml.etree.ElementTree as ET
```

---

#### ğŸŸ¡ **A4. Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹ except**

**Ğ¤Ğ°Ğ¹Ğ»:** `core/iiko_api.py:58`

**ĞšĞ¾Ğ´:**
```python
try:
    requests.get(url, params=params)
except:  # âš ï¸ Ğ›ĞĞ’Ğ˜Ğ¢ Ğ’Ğ¡Ğ (Ğ´Ğ°Ğ¶Ğµ KeyboardInterrupt!)
    pass
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞœĞ¾Ğ¶ĞµÑ‚ ÑĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
except Exception as e:
    print(f"[ERROR] Logout failed: {e}")
```

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ B: IIKO API ISSUES

#### ğŸ”´ **B1. Missing disconnect() Ğ² try-finally Ğ±Ğ»Ğ¾ĞºĞ°Ñ…** (8 endpoints!)

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `app.py:124-132` - `/api/analyze`
- `app.py:303-314` - `/api/category-analyze`
- `app.py:439-443` - `/api/draft-analyze`
- `app.py:786-791` - `/api/waiter-analyze`
- `app.py:1251-1272` - `/api/stocks-analyze`
- `app.py:1428-1450` - `/api/stocks/kitchen`
- `app.py:1574-1602` - `/api/taps/beers`
- `app.py:92-94` - `/api/connection-status`

**ĞšĞ¾Ğ´ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ `/api/analyze`):**
```python
olap = OlapReports()
if not olap.connect():
    return jsonify({'error': '...'}), 500

report_data = olap.get_beer_sales_report(...)  # âš ï¸ Ğ•ÑĞ»Ğ¸ Ñ‚ÑƒÑ‚ exception
olap.disconnect()  # âš ï¸ disconnect() ĞĞ• Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ÑÑ!
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ•ÑĞ»Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ `connect()` Ğ¸ `disconnect()` Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ğ´Ñ‘Ñ‚ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ, Ñ‚Ğ¾ĞºĞµĞ½ iiko API Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´Ñ‘Ğ½, ÑĞ»Ğ¾Ñ‚ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½ĞµÑ‚ÑÑ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹Ğ¼.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
olap = OlapReports()
if not olap.connect():
    return jsonify({'error': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº iiko API'}), 500

try:
    report_data = olap.get_beer_sales_report(date_from, date_to, bar_name)

    if not report_data or not report_data.get('data'):
        return jsonify({'error': 'ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´'}), 404

    # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...
    processor = BeerDataProcessor(report_data)
    # ...

    return jsonify(result)

finally:
    olap.disconnect()  # âš ï¸ Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ!
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ’Ğ¡Ğ•Ğ¥ 8 endpoints!**

---

#### ğŸŸ¡ **B2. ĞĞµÑ‚ timeout Ğ´Ğ»Ñ requests**

**Ğ¤Ğ°Ğ¹Ğ»:** `core/iiko_api.py:31`

**ĞšĞ¾Ğ´:**
```python
response = requests.get(url, params=params)  # âš ï¸ Ğ‘Ğ•Ğ— TIMEOUT!
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ½ÑƒÑ‚ÑŒ Ğ±ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
response = requests.get(url, params=params, timeout=30)
```

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ C: FLASK ISSUES

#### ğŸŸ  **C1. ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ CORS Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°**

**Ğ¤Ğ°Ğ¹Ğ»:** `app.py`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ•ÑĞ»Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ½Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°Ñ…, API Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```bash
pip install flask-cors
```

```python
# app.py
from flask_cors import CORS

app = Flask(__name__)
CORS(app, resources={r"/api/*": {"origins": "*"}})
```

---

#### ğŸŸ  **C2. ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ security headers**

**Ğ¤Ğ°Ğ¹Ğ»:** `app.py`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞĞµÑ‚ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ clickjacking, MIME sniffing Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ°Ñ‚Ğ°Ğº.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
@app.after_request
def add_security_headers(response):
    response.headers['X-Content-Type-Options'] = 'nosniff'
    response.headers['X-Frame-Options'] = 'SAMEORIGIN'
    response.headers['X-XSS-Protection'] = '1; mode=block'
    response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains'
    return response
```

---

#### ğŸŸ¡ **C3. ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ XSS - Ğ½ĞµÑ‚ HTML escaping**

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:** Ğ’ÑĞµ templates (30+ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ `innerHTML`)

**ĞšĞ¾Ğ´ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ `draft.html:1006`):**
```javascript
const modalHTML = `
    <h2>${beer.BeerName}</h2>  <!-- âš ï¸ ĞĞ• Ğ­ĞšĞ ĞĞĞ˜Ğ Ğ£Ğ•Ğ¢Ğ¡Ğ¯! -->
    <p>${beer.Bar}</p>
`;
document.body.insertAdjacentHTML('beforeend', modalHTML);
```

**Ğ Ğ¸ÑĞº:** Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… iiko API Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ÑÑ `<script>alert('XSS')</script>`, Ğ¾Ğ½ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑÑ.

**ĞÑ†ĞµĞ½ĞºĞ°:** ğŸŸ¡ ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº (Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ĞµĞ³Ğ¾ API, Ğ½Ğµ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ).

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```javascript
// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ template
function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
const modalHTML = `
    <h2>${escapeHtml(beer.BeerName)}</h2>
    <p>${escapeHtml(beer.Bar)}</p>
`;
```

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ D: FRONTEND ISSUES

#### âœ… **D1. ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°**

Ğ’ÑĞµ templates Ğ¸Ğ¼ĞµÑÑ‚ `@media (max-width: 768px)` breakpoints. Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾!

#### âœ… **D2. Overflow Ğ¸ table-layout Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ:
- `overflow-y: auto` Ğ´Ğ»Ñ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ°
- `overflow-x: auto` Ğ´Ğ»Ñ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
- `-webkit-overflow-scrolling: touch` Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ° Ğ½Ğ° iOS
- `table-layout: fixed` Ğ´Ğ»Ñ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñ‹

ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ E: LOGIC ERRORS

#### âœ… **E1. Timezone Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ**

`ZoneInfo("Europe/Moscow")` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²:
- `taps_manager.py:68`
- `olap_reports.py:41`

ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾!

---

#### ğŸŸ  **E2. Race condition Ğ² TapsManager**

**Ğ¤Ğ°Ğ¹Ğ»:** `core/taps_manager.py`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞĞµÑ‚ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº (threading.Lock) Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ `taps_data.json`.

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
1. Request A Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ `taps_data.json`
2. Request B Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ `taps_data.json` (Ñ‚Ğµ Ğ¶Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
3. Request A Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚
4. Request B Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ (ĞŸĞ•Ğ Ğ•Ğ—ĞĞŸĞ˜Ğ¡Ğ«Ğ’ĞĞ•Ğ¢ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ A!)

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
# core/taps_manager.py
import threading

class TapsManager:
    def __init__(self, data_file: str = 'data/taps_data.json'):
        self.data_file = data_file
        self.bars: Dict[str, Bar] = {}
        self._lock = threading.Lock()  # âš ï¸ Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞšĞ£!
        self._init_bars()
        self._load_data()

    def _save_data(self):
        """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ„Ğ°Ğ¹Ğ»"""
        with self._lock:  # âš ï¸ Ğ—ĞĞ©Ğ˜Ğ¢Ğ ĞĞ¢ RACE CONDITION!
            try:
                os.makedirs(os.path.dirname(self.data_file) or '.', exist_ok=True)
                data = {}
                for bar_id, bar in self.bars.items():
                    data[bar_id] = {
                        'name': bar.name,
                        'taps': [tap.to_dict() for tap in bar.taps.values()]
                    }
                with open(self.data_file, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=2)
            except Exception as e:
                print(f"[ERROR] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ ĞºÑ€Ğ°Ğ½Ğ°Ñ…: {e}")
```

Ğ¢Ğ°ĞºĞ¶Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ lock Ğ² Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹: `start_tap()`, `stop_tap()`, `replace_tap()`.

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ F: PERFORMANCE ISSUES

#### ğŸ”´ **F1. ĞĞµÑ‚ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ nomenclature**

**Ğ¤Ğ°Ğ¹Ğ»:** `app.py:1255, 1439, 1584`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** `get_nomenclature()` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² 3 endpoints Ğ±ĞµĞ· ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
- `/api/stocks-analyze`
- `/api/stocks/kitchen`
- `/api/taps/beers`

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ğ´ĞµĞ»Ğ°ĞµÑ‚ÑÑ HTTP call Ğº iiko API Ğ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ XML.

**ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ:**
- ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ API
- Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ° iiko API
- Ğ›Ğ¸ÑˆĞ½Ğ¸Ğ¹ Ñ€Ğ°ÑÑ…Ğ¾Ğ´ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ñ‚Ğ¾Ğ²

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```python
# Ğ’ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ app.py
from datetime import datetime, timedelta

nomenclature_cache = {
    'data': None,
    'expires': None
}

def get_cached_nomenclature(olap):
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ¼ĞµĞ½ĞºĞ»Ğ°Ñ‚ÑƒÑ€Ñƒ Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ° 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚"""
    now = datetime.now()

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºÑÑˆ
    if nomenclature_cache['data'] and nomenclature_cache['expires'] and nomenclature_cache['expires'] > now:
        print("[CACHE] Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºÑÑˆ Ğ½Ğ¾Ğ¼ĞµĞ½ĞºĞ»Ğ°Ñ‚ÑƒÑ€Ñ‹")
        return nomenclature_cache['data']

    # Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ ÑĞ²ĞµĞ¶Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    print("[CACHE] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºÑÑˆ Ğ½Ğ¾Ğ¼ĞµĞ½ĞºĞ»Ğ°Ñ‚ÑƒÑ€Ñ‹")
    data = olap.get_nomenclature()

    if data:
        nomenclature_cache['data'] = data
        nomenclature_cache['expires'] = now + timedelta(minutes=15)

    return data

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¾ Ğ²ÑĞµÑ… endpoints:
nomenclature = get_cached_nomenclature(olap)
```

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ G: ARCHITECTURE ISSUES

#### ğŸŸ¡ **G1. Hardcoded GUID Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²**

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:** `app.py:1591`, `test_fasovka_group.py:18`

**ĞšĞ¾Ğ´:**
```python
FASOVKA_GROUP_ID = '6103ecbf-e6f8-49fe-8cd2-6102d49e14a6'  # âš ï¸ Ğ¥ĞĞ Ğ”ĞšĞĞ”
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** GUID Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ·Ğ°Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ¶ĞµĞ½ Ğ² Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ….

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ² `config.py`:
```python
# config.py
FASOVKA_GROUP_ID = '6103ecbf-e6f8-49fe-8cd2-6102d49e14a6'
ROZLIV_GROUP_NAME = 'ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸ Ğ Ğ¾Ğ·Ğ»Ğ¸Ğ²'
FASOVKA_GROUP_NAME = 'ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸ Ğ¤Ğ°ÑĞ¾Ğ²ĞºĞ°'
```

```python
# app.py
from config import FASOVKA_GROUP_ID

fasovka_product_ids = olap.get_products_in_group(FASOVKA_GROUP_ID, nomenclature)
```

---

#### ğŸŸ  **G2. Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ extract_beer_info()**

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:** `core/draft_analysis.py:28-70`, `core/waiter_analysis.py:45-86`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `extract_beer_info()` (45 ÑÑ‚Ñ€Ğ¾Ğº regex Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸) Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² 2 Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ….

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ’Ñ‹Ğ½ĞµÑÑ‚Ğ¸ Ğ² `core/utils.py`:
```python
# core/utils.py
import re

def extract_beer_info(dish_name: str) -> tuple[str, float]:
    """
    Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¸Ğ²Ğ° Ğ¸ Ğ¾Ğ±ÑŠĞµĞ¼ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸ Ğ¸Ğ· DishName

    ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
    "Ğ¤ĞµÑÑ‚Ğ¥Ğ°ÑƒÑ Ğ¥ĞµĞ»Ğ»ĞµÑ (0,5)" -> ("Ğ¤ĞµÑÑ‚Ğ¥Ğ°ÑƒÑ Ğ¥ĞµĞ»Ğ»ĞµÑ", 0.5)
    "Ğ‘Ğ»ĞµĞº Ğ¨Ğ¸Ğ¿ (0,25)" -> ("Ğ‘Ğ»ĞµĞº Ğ¨Ğ¸Ğ¿", 0.25)
    "Ğ¥Ğ‘ ĞĞºÑ‚Ğ¾Ğ±ĞµÑ€Ñ„ĞµÑÑ‚ (1,0) Ñ ÑĞ¾Ğ±Ğ¾Ğ¹" -> ("Ğ¥Ğ‘ ĞĞºÑ‚Ğ¾Ğ±ĞµÑ€Ñ„ĞµÑÑ‚", 1.0)
    """
    # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ 1: Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğµ Ñ‡Ğ¸ÑĞ»Ğ° Ğ² Ğ»Ğ¸Ñ‚Ñ€Ğ°Ñ… (0,5 Ğ¸Ğ»Ğ¸ 0.5)
    pattern_liters = r'\((\d+[,\.]\d+)\s*(?:Ğ»|l)?\)'
    match = re.search(pattern_liters, dish_name.strip(), re.IGNORECASE)

    if match:
        volume_str = match.group(1).replace(',', '.')
        volume = float(volume_str)
        beer_name = dish_name[:match.start()].strip()
        return beer_name, volume

    # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ 2: Ñ†ĞµĞ»Ñ‹Ğµ Ñ‡Ğ¸ÑĞ»Ğ° Ğ² Ğ»Ğ¸Ñ‚Ñ€Ğ°Ñ… (2)
    pattern_whole_liters = r'\((\d+)\s*(?:Ğ»|l)?\)'
    match = re.search(pattern_whole_liters, dish_name.strip(), re.IGNORECASE)

    if match:
        volume = float(match.group(1))
        beer_name = dish_name[:match.start()].strip()
        return beer_name, volume

    # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ 3: Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ»Ğ¸Ñ‚Ñ€Ñ‹ (500Ğ¼Ğ», 500ml)
    pattern_ml = r'\((\d+)\s*(?:Ğ¼Ğ»|ml)\)'
    match = re.search(pattern_ml, dish_name.strip(), re.IGNORECASE)

    if match:
        volume_ml = float(match.group(1))
        volume = volume_ml / 1000
        beer_name = dish_name[:match.start()].strip()
        return beer_name, volume

    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ
    return dish_name, 0.0
```

```python
# core/draft_analysis.py Ğ¸ core/waiter_analysis.py
from core.utils import extract_beer_info

class DraftAnalysis:
    def prepare_draft_data(self):
        beer_info = self.df['DishName'].apply(extract_beer_info)
        # ...
```

---

### ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ¯ H: API DOCUMENTATION

Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» **6. API Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ¦Ğ˜Ğ¯** Ğ½Ğ¸Ğ¶Ğµ.

---

## 4. Ğ¡ĞŸĞ•Ğ¦Ğ˜Ğ¤Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ«

### 4.1. Encoding (UTF-8/Cyrillic)

#### âœ… **Ğ§Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾:**

1. **RFC 5987 Ğ´Ğ»Ñ filename Ğ² Content-Disposition** (`app.py:1040`):
   ```python
   response.headers['Content-Disposition'] = f"attachment; filename={filename}; filename*=UTF-8''{quote(filename)}"
   ```

2. **UTF BOM Ğ´Ğ»Ñ CSV ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°** (Ğ²ÑĞµ templates):
   ```javascript
   const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
   ```

3. **JSON dumps Ñ ensure_ascii=False** (`taps_manager.py:124`, `olap_reports.py`):
   ```python
   json.dump(data, f, ensure_ascii=False, indent=2)
   ```

4. **Transliteration Ğ² print() Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**:
   ```python
   print("[ANALIZ] Zapusk analiza...")  # Ğ›Ğ°Ñ‚Ğ¸Ğ½Ğ¸Ñ†Ğ° Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñ‹
   ```

#### âš ï¸ **ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**

ĞĞµÑ‚ ÑĞ²Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ñ encoding. Ğ’ÑÑ‘ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾!

---

### 4.2. Mobile Adaptation

#### âœ… **Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾:**

Ğ’ÑĞµ templates Ğ¸Ğ¼ĞµÑÑ‚ responsive breakpoints:

```css
@media (max-width: 768px) {
    .controls {
        grid-template-columns: 1fr;
    }

    .header-left h1 {
        font-size: 2.5rem;
    }

    .card {
        padding: 15px;
    }
}
```

Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ² `stocks.html`:
```css
@media (max-width: 480px) {
    /* Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ñ… ÑĞºÑ€Ğ°Ğ½Ğ¾Ğ² */
}
```

**Ğ’Ñ‹Ğ²Ğ¾Ğ´:** ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°! âœ…

---

### 4.3. iiko API Integration

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:

1. **ğŸ”´ Missing disconnect() Ğ² 8 endpoints** - ÑĞ¼. [B1](#ğŸ”´-b1-missing-disconnect-Ğ²-try-finally-Ğ±Ğ»Ğ¾ĞºĞ°Ñ…-8-endpoints)
2. **ğŸ”´ ĞĞµÑ‚ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ nomenclature** - ÑĞ¼. [F1](#ğŸ”´-f1-Ğ½ĞµÑ‚-ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ-nomenclature)
3. **ğŸŸ¡ ĞĞµÑ‚ timeout** - ÑĞ¼. [B2](#ğŸŸ¡-b2-Ğ½ĞµÑ‚-timeout-Ğ´Ğ»Ñ-requests)

#### Ğ§Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾:

1. âœ… XML Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½ (`olap_reports.py:92-110`)
2. âœ… SHA-1 Ñ…ÑÑˆ Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ (ĞºĞ°Ğº Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ iiko API)
3. âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° OLAP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹, Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°)

---

### 4.4. Render Deployment

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:

1. **ğŸŸ  Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸** - ÑĞ¼. [A2](#ğŸŸ -a2-Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ-Ğ¿ÑƒÑ‚Ğ¸-Ğ±ĞµĞ·-ÑƒÑ‡ĞµÑ‚Ğ°-persist-disk)
2. **ğŸ”´ ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸** - ÑĞ¼. [A1](#ğŸ”´-a1-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ-Ğ²-Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼-Ğ²Ğ¸Ğ´Ğµ)

#### Ğ§Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾:

1. âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ»Ñ `TAPS_DATA_PATH` (`app.py:20-25`):
   ```python
   TAPS_DATA_PATH = os.environ.get('TAPS_DATA_FILE', 'data/taps_data.json')
   if os.path.exists('/kultura'):
       TAPS_DATA_PATH = '/kultura/taps_data.json'
   ```

2. âœ… Persist disk Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² `/kultura`

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚Ñƒ Ğ¶Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ´Ğ»Ñ `all_products.json`.

---

## 5. Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ¦Ğ˜Ğ˜

### 5.1. Ğ¡Ğ ĞĞ§ĞĞ«Ğ• Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ (ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ: ğŸ”´ğŸŸ )

ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: **ĞĞ•ĞœĞ•Ğ”Ğ›Ğ•ĞĞĞ**

1. **ğŸ”´ ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ² environment variables** ([A1](#ğŸ”´-a1-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ-Ğ²-Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼-Ğ²Ğ¸Ğ´Ğµ))
   - Ğ¤Ğ°Ğ¹Ğ»: `config.py:7`
   - Ğ’Ñ€ĞµĞ¼Ñ: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

2. **ğŸ”´ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ try-finally Ğ´Ğ»Ñ disconnect() Ğ²Ğ¾ Ğ²ÑĞµÑ… 8 endpoints** ([B1](#ğŸ”´-b1-missing-disconnect-Ğ²-try-finally-Ğ±Ğ»Ğ¾ĞºĞ°Ñ…-8-endpoints))
   - Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `app.py` (8 Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹)
   - Ğ’Ñ€ĞµĞ¼Ñ: 30-40 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: Ğ£Ñ‚ĞµÑ‡ĞºĞ° Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ñ‚Ğ¾Ğ² iiko API

3. **ğŸ”´ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ nomenclature** ([F1](#ğŸ”´-f1-Ğ½ĞµÑ‚-ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ-nomenclature))
   - Ğ¤Ğ°Ğ¹Ğ»: `app.py`
   - Ğ’Ñ€ĞµĞ¼Ñ: 20 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° + Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞ° iiko API

4. **ğŸŸ  Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ threading.Lock Ğ² TapsManager** ([E2](#ğŸŸ -e2-race-condition-Ğ²-tapsmanager))
   - Ğ¤Ğ°Ğ¹Ğ»: `core/taps_manager.py`
   - Ğ’Ñ€ĞµĞ¼Ñ: 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ñ…

5. **ğŸŸ  Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸ Ğ´Ğ»Ñ persist disk** ([A2](#ğŸŸ -a2-Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ½Ñ‹Ğµ-Ğ¿ÑƒÑ‚Ğ¸-Ğ±ĞµĞ·-ÑƒÑ‡ĞµÑ‚Ğ°-persist-disk))
   - Ğ¤Ğ°Ğ¹Ğ»: `app.py:1078, 1159`
   - Ğ’Ñ€ĞµĞ¼Ñ: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° production (Render)

6. **ğŸŸ  Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ security headers** ([C2](#ğŸŸ -c2-Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚-security-headers))
   - Ğ¤Ğ°Ğ¹Ğ»: `app.py`
   - Ğ’Ñ€ĞµĞ¼Ñ: 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ Ğ¸ÑĞº: Ğ£ÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

**ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ½Ğ° ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ: ~2 Ñ‡Ğ°ÑĞ°**

---

### 5.2. Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ: ğŸŸ¡)

ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: **Ğ‘Ğ›Ğ˜Ğ–ĞĞ™Ğ¨Ğ•Ğ• Ğ’Ğ Ğ•ĞœĞ¯**

1. **Ğ’Ñ‹Ğ½ĞµÑÑ‚Ğ¸ extract_beer_info() Ğ² utils** ([G2](#ğŸŸ -g2-Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸-extract_beer_info))
   - Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ 45 ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°
   - Ğ’Ñ€ĞµĞ¼Ñ: 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚

2. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ timeout Ğ´Ğ»Ñ requests** ([B2](#ğŸŸ¡-b2-Ğ½ĞµÑ‚-timeout-Ğ´Ğ»Ñ-requests))
   - Ğ¤Ğ°Ğ¹Ğ»: `core/iiko_api.py`
   - Ğ’Ñ€ĞµĞ¼Ñ: 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚

3. **ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ GUID Ğ² config** ([G1](#ğŸŸ¡-g1-hardcoded-guid-Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹-Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²))
   - Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `config.py`, `app.py`
   - Ğ’Ñ€ĞµĞ¼Ñ: 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚

4. **ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ imports Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°** ([A3](#ğŸŸ¡-a3-import-Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸))
   - Ğ¤Ğ°Ğ¹Ğ»: `app.py:1118-1120`
   - Ğ’Ñ€ĞµĞ¼Ñ: 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹

5. **Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğµ except** ([A4](#ğŸŸ¡-a4-ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼-ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğ¹-except))
   - Ğ¤Ğ°Ğ¹Ğ»: `core/iiko_api.py:58`
   - Ğ’Ñ€ĞµĞ¼Ñ: 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹

**ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ: ~35 Ğ¼Ğ¸Ğ½ÑƒÑ‚**

---

### 5.3. Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ (ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ: ğŸŸ¢)

ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: **ĞŸĞ Ğ’ĞĞ—ĞœĞĞ–ĞĞĞ¡Ğ¢Ğ˜**

1. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ CORS support** ([C1](#ğŸŸ -c1-Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚-cors-Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°))
   - Ğ•ÑĞ»Ğ¸ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ° Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´Ğ°

2. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ escapeHtml() Ğ´Ğ»Ñ innerHTML** ([C3](#ğŸŸ¡-c3-Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ-xss---Ğ½ĞµÑ‚-html-escaping))
   - ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº, Ğ½Ğ¾ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°

3. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ Analysis Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹**
   - ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ‰ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¸Ğ· `draft_analysis.py`, `waiter_analysis.py`, `category_analysis.py`

4. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ type hints Ğ²ĞµĞ·Ğ´Ğµ**
   - Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ¸ IDE Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ

5. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ unit tests**
   - ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸

---

### 5.4. ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

1. **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (logging)**
   - Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `print()` Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ»Ğ¾Ğ³Ğ¾Ğ²
   - Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `logging` Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ rotation

2. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹**
   - ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº (Sentry, Rollbar)
   - ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

3. **Backup ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°**
   - Ğ•ÑÑ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚), Ğ½Ğ¾ Ğ½ĞµÑ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸

4. **API Rate Limiting**
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºĞ¸ endpoints

5. **ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ**
   - Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾
   - Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

---

## 6. API Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ¦Ğ˜Ğ¯

### Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ URL

```
http://localhost:5000  (development)
https://your-app.onrender.com  (production)
```

### Endpoints Overview

| Endpoint | Method | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|--------|----------|
| `/` | GET | Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (ABC/XYZ Ñ„Ğ°ÑĞ¾Ğ²ĞºĞ°) |
| `/draft` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ°Ğ¼ |
| `/waiters` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ Ğ±Ğ°Ñ€Ğ¼ĞµĞ½Ğ°Ğ¼ |
| `/taps` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºÑ€Ğ°Ğ½Ğ¾Ğ² |
| `/stocks` | GET | Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¾Ğ² Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ² |
| `/taps/<bar_id>` | GET | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸ Ğ±Ğ°Ñ€Ğ° |
| **API Endpoints** | | |
| `/api/test` | GET, POST | Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ endpoint |
| `/api/connection-status` | GET | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº iiko API |
| `/api/analyze` | POST | ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°ÑĞ¾Ğ²ĞºĞ¸ |
| `/api/weekly-chart/<bar>/<beer>` | GET | Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ¿Ğ¾ Ğ½ĞµĞ´ĞµĞ»ÑĞ¼ |
| `/api/categories` | POST | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ Ğ¿Ğ¸Ğ²Ğ° |
| `/api/draft-analyze` | POST | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ° |
| `/api/waiter-analyze` | POST | ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ¾ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ½Ñ‚Ğ°Ğ¼ |
| `/api/taps/bars` | GET | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ±Ğ°Ñ€Ğ¾Ğ² |
| `/api/taps/<bar_id>` | GET | ĞšÑ€Ğ°Ğ½Ñ‹ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ°Ñ€Ğ° |
| `/api/taps/<bar_id>/start` | POST | ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ |
| `/api/taps/<bar_id>/stop` | POST | ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ |
| `/api/taps/<bar_id>/replace` | POST | Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ |
| `/api/taps/<bar_id>/<tap>/history` | GET | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºÑ€Ğ°Ğ½Ğ° |
| `/api/taps/events/all` | GET | Ğ’ÑĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ĞºÑ€Ğ°Ğ½Ğ¾Ğ² |
| `/api/taps/statistics` | GET | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºÑ€Ğ°Ğ½Ğ¾Ğ² |
| `/api/taps/export-taplist` | GET | Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºĞµĞ³ Ğ² CSV |
| `/api/taps/<bar_id>/stats` | GET | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ°Ñ€Ğ° |
| `/api/beers/draft` | GET | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ° |
| `/api/update-nomenclature` | POST | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºÑÑˆ Ğ½Ğ¾Ğ¼ĞµĞ½ĞºĞ»Ğ°Ñ‚ÑƒÑ€Ñ‹ |
| `/api/stocks/taplist` | GET | ĞÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ |
| `/api/stocks/kitchen` | GET | ĞÑÑ‚Ğ°Ñ‚ĞºĞ¸ ĞºÑƒÑ…Ğ½Ğ¸ |
| `/api/stocks/bottles` | GET | ĞÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ñ„Ğ°ÑĞ¾Ğ²ĞºĞ¸ |

---

### Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ endpoints

#### 1. `GET /api/connection-status`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº iiko API

**Request Parameters:** ĞĞµÑ‚

**Response (200 OK):**
```json
{
  "status": "connected",
  "message": "ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº iiko API ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
}
```

**Response (500 Error):**
```json
{
  "status": "error",
  "message": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº iiko API"
}
```

---

#### 2. `POST /api/analyze`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ°

**Request Body:**
```json
{
  "bar": "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ",  // Ğ¸Ğ»Ğ¸ null Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ±Ğ°Ñ€Ğ¾Ğ²
  "days": 30                  // ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ½Ğ°Ğ·Ğ°Ğ´
}
```

**Response (200 OK):**
```json
{
  "bars": {
    "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ": {
      "beers": [
        {
          "Beer": "Guinness Original 0.44",
          "Style": "Irish Stout",
          "Country": "Ğ˜Ñ€Ğ»Ğ°Ğ½Ğ´Ğ¸Ñ",
          "TotalQty": 245.0,
          "TotalRevenue": 122500.0,
          "TotalCost": 73500.0,
          "AvgMarkupPercent": 66.67,
          "TotalMargin": 49000.0,
          "ABC_Revenue": "A",
          "ABC_Markup": "B",
          "ABC_Margin": "A",
          "ABC_Combined": "ABA",
          "XYZ_Category": "X",
          "CoefficientOfVariation": 8.5
        }
      ],
      "total_beers": 156,
      "total_revenue": 3456789.0
    }
  }
}
```

**Response (404 Not Found):**
```json
{
  "error": "ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´"
}
```

**Response (500 Error):**
```json
{
  "error": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº iiko API"
}
```

---

#### 3. `POST /api/draft-analyze`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ°

**Request Body:**
```json
{
  "bar": "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ",  // Ğ¸Ğ»Ğ¸ null
  "days": null,               // Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹
  "dateFrom": "2024-01-01",   // ĞµÑĞ»Ğ¸ days=null
  "dateTo": "2024-12-31"      // ĞµÑĞ»Ğ¸ days=null
}
```

**Response (200 OK):**
```json
{
  "beers": [
    {
      "BeerName": "Ñ„ĞµÑÑ‚Ñ…Ğ°ÑƒÑ Ñ…ĞµĞ»Ğ»ĞµÑ",
      "Bar": "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ",
      "TotalLiters": 1245.5,
      "TotalPortions": 2491,
      "WeeksActive": 52,
      "AvgLitersPerWeek": 23.95,
      "BeerSharePercent": 18.3,
      "Kegs30L": 41.52,
      "Kegs50L": 24.91,
      "TotalRevenue": 498200.0,
      "TotalCost": 298920.0,
      "AvgMarkupPercent": 66.67,
      "TotalMargin": 199280.0,
      "ABC_Combined": "AAA",
      "XYZ_Category": "X",
      "CoefficientOfVariation": 5.2,
      "ABCXYZ_Combined": "AAA-X"
    }
  ],
  "summary": {
    "total_beers": 45,
    "total_liters": 6800.0,
    "total_kegs_30l": 226.67,
    "total_revenue": 2720000.0
  }
}
```

---

#### 4. `POST /api/waiter-analyze`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ¿Ğ¾ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ½Ñ‚Ğ°Ğ¼

**Request Body:**
```json
{
  "bar": "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ",  // Ğ¸Ğ»Ğ¸ null
  "days": null,
  "dateFrom": "2024-01-01",
  "dateTo": "2024-12-31"
}
```

**Response (200 OK):**
```json
{
  "waiters": [
    {
      "WaiterName": "Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² Ğ˜Ğ²Ğ°Ğ½",
      "Bar": "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€. Ğ’.Ğ",
      "TotalLiters": 3456.7,
      "TotalPortions": 6913,
      "UniqueBeers": 42,
      "Kegs30L": 115.22,
      "Kegs50L": 69.13,
      "TotalRevenue": 1382680.0,
      "TotalCost": 829608.0,
      "AvgMarkupPercent": 66.67,
      "TotalMargin": 553072.0,
      "beers": [
        {
          "BeerName": "Ñ„ĞµÑÑ‚Ñ…Ğ°ÑƒÑ Ñ…ĞµĞ»Ğ»ĞµÑ",
          "TotalLiters": 450.5,
          "TotalPortions": 901,
          "TotalRevenue": 180200.0
        }
      ]
    }
  ]
}
```

---

#### 5. `GET /api/taps/bars`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ±Ğ°Ñ€Ğ¾Ğ² Ñ ĞºÑ€Ğ°Ğ½Ğ°Ğ¼Ğ¸

**Response (200 OK):**
```json
[
  {
    "bar_id": "bar1",
    "name": "Ğ‘Ğ°Ñ€ 1",
    "tap_count": 24,
    "active_taps": 18
  },
  {
    "bar_id": "bar2",
    "name": "Ğ‘Ğ°Ñ€ 2",
    "tap_count": 12,
    "active_taps": 9
  }
]
```

---

#### 6. `POST /api/taps/<bar_id>/start`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞµĞ³Ñƒ Ğº ĞºÑ€Ğ°Ğ½Ñƒ

**URL Parameters:**
- `bar_id`: ID Ğ±Ğ°Ñ€Ğ° (bar1, bar2, bar3, bar4)

**Request Body:**
```json
{
  "tap_number": 5,
  "beer_name": "Ğ¤ĞµÑÑ‚Ğ¥Ğ°ÑƒÑ Ğ¥ĞµĞ»Ğ»ĞµÑ",
  "keg_id": "KEG-2024-001"
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "tap_number": 5,
  "beer_name": "Ğ¤ĞµÑÑ‚Ğ¥Ğ°ÑƒÑ Ğ¥ĞµĞ»Ğ»ĞµÑ",
  "status": "started"
}
```

**Response (500 Error):**
```json
{
  "success": false,
  "error": "Ğ‘Ğ°Ñ€ bar5 Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
}
```

---

#### 7. `GET /api/stocks/taplist?bar=<bar_name>`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ğ²Ğ°

**Query Parameters:**
- `bar`: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ°Ñ€Ğ° Ğ¸Ğ»Ğ¸ "ĞĞ±Ñ‰Ğ°Ñ"

**Response (200 OK):**
```json
{
  "total_items": 45,
  "low_stock_count": 3,
  "items": [
    {
      "BeerName": "Ñ„ĞµÑÑ‚Ñ…Ğ°ÑƒÑ Ñ…ĞµĞ»Ğ»ĞµÑ",
      "CurrentStock": 180.5,
      "AvgConsumption": 23.5,
      "DaysLeft": 7.68,
      "StockLevel": "medium",
      "Kegs30L": 6.02,
      "Kegs50L": 3.61,
      "LinkedTaps": [5, 12]
    }
  ]
}
```

---

### Error Codes

| Code | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| 200 | OK - Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ |
| 400 | Bad Request - ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ |
| 404 | Not Found - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ |
| 500 | Internal Server Error - ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ° |

### Common Error Response Format

```json
{
  "error": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸"
}
```

---

## 7. Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ ĞŸĞ ĞĞ•ĞšĞ¢Ğ

### 7.1. ĞšĞ¾Ğ´

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|---------|----------|
| **Python ĞºĞ¾Ğ´ (app.py + core/*)** | 4,445 ÑÑ‚Ñ€Ğ¾Ğº |
| **HTML templates** | 8,111 ÑÑ‚Ñ€Ğ¾Ğº |
| **Python Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²** | 11 |
| **HTML templates** | 7 |
| **API endpoints** | 24 |
| **iiko API calls** | 6 Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ² |

### 7.2. ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ |
|-----------|-------------|------------|
| **A. ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸** | ğŸ”´ğŸŸ ğŸŸ¡ | 4 |
| **B. iiko API issues** | ğŸ”´ğŸŸ¡ | 2 |
| **C. Flask issues** | ğŸŸ ğŸŸ¡ | 3 |
| **D. Frontend issues** | âœ… | 0 (Ğ²ÑÑ‘ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾) |
| **E. Logic errors** | ğŸŸ âœ… | 1 |
| **F. Performance** | ğŸ”´ | 1 |
| **G. Architecture** | ğŸŸ¡ğŸŸ  | 2 |
| **H. API Documentation** | âœ… | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ |
| **Ğ˜Ğ¢ĞĞ“Ğ** | | **13 Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼** |

### 7.3. ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ

| ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ | Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ° Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ |
|-----------|------------|----------------------|
| ğŸ”´ **ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾** | 4 | ~1.5 Ñ‡Ğ°ÑĞ° |
| ğŸŸ  **Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹** | 4 | ~0.5 Ñ‡Ğ°ÑĞ° |
| ğŸŸ¡ **Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹** | 5 | ~0.5 Ñ‡Ğ°ÑĞ° |
| ğŸŸ¢ **ĞĞ¸Ğ·ĞºĞ¸Ğ¹** | 0 | - |
| **Ğ˜Ğ¢ĞĞ“Ğ** | **13** | **~2.5 Ñ‡Ğ°ÑĞ°** |

### 7.4. ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ´Ğ°

#### âœ… Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾:

1. **UTF-8 encoding** - Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ²ĞµĞ·Ğ´Ğµ (RFC 5987, UTF BOM, ensure_ascii=False)
2. **Timezone** - Moscow TZ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾
3. **ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ** - media queries Ğ²Ğ¾ Ğ²ÑĞµÑ… templates
4. **Overflow handling** - Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ overflow-x/y Ğ´Ğ»Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
5. **Dark/Light theme** - localStorage, CSS custom properties
6. **CSV export** - UTF-8 BOM Ğ´Ğ»Ñ Excel
7. **ABC/XYZ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹** - Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹
8. **ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¾Ğ±ÑŠĞµĞ¼Ğ¾Ğ²** - regex Ğ´Ğ»Ñ "(0,5)", "(2)", "(500Ğ¼Ğ»)"
9. **iiko API integration** - Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° OLAP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
10. **ĞšĞ¾Ğ´ ÑÑ‚Ğ¸Ğ»ÑŒ** - Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹, Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸

#### âš ï¸ Ğ§Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ:

1. **Security** - Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸, Ğ½ĞµÑ‚ security headers
2. **Error handling** - missing disconnect(), ÑˆĞ¸Ñ€Ğ¾ĞºĞ¸Ğµ except
3. **Performance** - Ğ½ĞµÑ‚ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ nomenclature
4. **Concurrency** - race conditions Ğ² TapsManager
5. **Architecture** - Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°, Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´

---

## Ğ—ĞĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ•

ĞŸÑ€Ğ¾ĞµĞºÑ‚ **beer-abc-analysis** Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ±Ğ¾Ğ¹ **Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ** Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¾Ğ¹ ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°, ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¼ frontend Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ñ‹.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
1. ğŸ”´ **Security** - Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ
2. ğŸ”´ **Reliability** - ÑƒÑ‚ĞµÑ‡ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² iiko API Ğ¿Ñ€Ğ¸ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑÑ…
3. ğŸ”´ **Performance** - Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
4. ğŸŸ  **Concurrency** - race conditions Ğ² TapsManager

**ĞĞ±Ñ‰Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° ĞºĞ¾Ğ´Ğ°:** 7.5/10

**ĞŸĞ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº:** 9/10

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ 4 ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ (ğŸ”´) Ğ² Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (~1.5 Ñ‡Ğ°ÑĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹), Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾.

---

**ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½:** 2025-11-16
**Ğ’Ñ€ĞµĞ¼Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:** ~2 Ñ‡Ğ°ÑĞ° (Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹)
**ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:** 18 (11 Python + 7 HTML)
**ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°:** 12,556

**ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ»:** Claude Sonnet 4.5
**Ğ’ĞµÑ€ÑĞ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:** 1.0
