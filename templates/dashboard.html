<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дашборд - Аналитика план vs факт</title>

    <!-- CSS Стили (модульный подход) -->
    <link rel="stylesheet" href="/static/dashboard/styles/variables.css">
    <link rel="stylesheet" href="/static/dashboard/styles/base.css">
    <link rel="stylesheet" href="/static/dashboard/styles/tabs.css">
    <link rel="stylesheet" href="/static/dashboard/styles/cards.css">
    <link rel="stylesheet" href="/static/dashboard/styles/charts.css">
    <link rel="stylesheet" href="/static/dashboard/styles/animations.css">
    <link rel="stylesheet" href="/static/dashboard/styles/mobile.css">

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

    <!-- Главный layout -->
    {% include 'dashboard/base.html' %}

    <!-- JavaScript модули (ES6 modules) -->
    <script type="module">
        // Cache busting version - динамический timestamp для обхода кэша
        const v = Date.now();

        // Импортируем главный файл
        import(`/static/js/dashboard/main.js?v=${v}`).then(() => {
            // Импортируем дополнительные модули
            return Promise.all([
                import(`/static/js/dashboard/modules/export.js?v=${v}`),
                import(`/static/js/dashboard/modules/comparison.js?v=${v}`)
            ]);
        }).then(([exportMod, comparisonMod]) => {
            // Инициализируем дополнительные модули
            if (exportMod && exportMod.exportModule) {
                exportMod.exportModule.init();
            }
            if (comparisonMod && comparisonMod.comparisonModule) {
                comparisonMod.comparisonModule.init();
            }
            console.log('✅ Dashboard loaded successfully!');
        }).catch(err => {
            console.error('❌ Error loading dashboard:', err);
        });
    </script>

    <!-- Fallback для старых браузеров -->
    <script nomodule>
        alert('Ваш браузер не поддерживает ES6 модули. Используйте современный браузер.');
    </script>

</body>
</html>
